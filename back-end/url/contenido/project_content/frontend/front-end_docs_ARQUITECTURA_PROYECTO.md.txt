# ARCHIVO: front-end/docs/ARQUITECTURA_PROYECTO.md
# URL: https://raw.githubusercontent.com/sTr4yDev/speakLexi/main/front-end/docs/ARQUITECTURA_PROYECTO.md
# FECHA DESCARGA: 2025-10-28 22:57:03
# ==================================================

# ğŸ“ Arquitectura del Proyecto SpeakLexi

## ğŸ“‹ Tabla de Contenidos
1. [VisiÃ³n General](#visiÃ³n-general)
2. [Estructura del Proyecto](#estructura-del-proyecto)
3. [MÃ³dulos del Sistema](#mÃ³dulos-del-sistema)
4. [Flujo de Datos](#flujo-de-datos)
5. [Componentes Principales](#componentes-principales)
6. [Rutas y NavegaciÃ³n](#rutas-y-navegaciÃ³n)
7. [Esquema de Base de Datos](#esquema-de-base-de-datos)
8. [APIs Necesarias para Backend](#apis-necesarias-para-backend)
9. [AutenticaciÃ³n y AutorizaciÃ³n](#autenticaciÃ³n-y-autorizaciÃ³n)
10. [IntegraciÃ³n Frontend-Backend](#integraciÃ³n-frontend-backend)

---

## ğŸ¯ VisiÃ³n General

SpeakLexi es una plataforma de aprendizaje de idiomas gamificada tipo Duolingo, construida con Next.js 15 (App Router), React 19, TypeScript, y Tailwind CSS v4. La arquitectura estÃ¡ diseÃ±ada para ser modular, escalable y fÃ¡cil de integrar con un backend Flask.

### TecnologÃ­as Frontend
- **Framework**: Next.js 15 (App Router)
- **UI Library**: React 19
- **Lenguaje**: TypeScript
- **Estilos**: Tailwind CSS v4
- **Componentes UI**: shadcn/ui
- **GestiÃ³n de Estado**: React Hooks + localStorage (temporal)
- **Futuro Backend**: Flask + PostgreSQL/Supabase

---

## ğŸ“ Estructura del Proyecto

\`\`\`
speaklexi/
â”œâ”€â”€ app/                          # Rutas de Next.js (App Router)
â”‚   â”œâ”€â”€ page.tsx                  # Landing page
â”‚   â”œâ”€â”€ layout.tsx                # Layout principal con fuentes
â”‚   â”œâ”€â”€ globals.css               # Estilos globales y tokens de diseÃ±o
â”‚   â”‚
â”‚   â”œâ”€â”€ login/                    # MÃ³dulo de AutenticaciÃ³n
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ registro/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ verificar-email/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ recuperar-contrasena/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ asignar-nivel/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ correo-enviado/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/                # MÃ³dulo Alumno
â”‚   â”‚   â””â”€â”€ page.tsx              # Dashboard principal del estudiante
â”‚   â”œâ”€â”€ lecciones/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Lista de lecciones
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx          # Visor de lecciÃ³n individual
â”‚   â”œâ”€â”€ logros/
â”‚   â”‚   â””â”€â”€ page.tsx              # Logros y recompensas
â”‚   â”œâ”€â”€ clasificacion/
â”‚   â”‚   â””â”€â”€ page.tsx              # Tabla de clasificaciÃ³n
â”‚   â”œâ”€â”€ progreso/
â”‚   â”‚   â””â”€â”€ page.tsx              # Progreso detallado del alumno
â”‚   â”œâ”€â”€ perfil/
â”‚   â”‚   â””â”€â”€ page.tsx              # Perfil del usuario
â”‚   â”œâ”€â”€ cambiar-curso/
â”‚   â”‚   â””â”€â”€ page.tsx              # Cambiar curso actual
â”‚   â”œâ”€â”€ eliminar-cuenta/
â”‚   â”‚   â””â”€â”€ page.tsx              # Eliminar cuenta (3 pasos)
â”‚   â”‚
â”‚   â”œâ”€â”€ profesor/                 # MÃ³dulo Profesor
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # Dashboard del profesor
â”‚   â”‚   â”œâ”€â”€ estadisticas/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # EstadÃ­sticas generales
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # Detalle de alumno individual
â”‚   â”‚   â”œâ”€â”€ retroalimentacion/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # GestiÃ³n de retroalimentaciÃ³n
â”‚   â”‚   â””â”€â”€ planificacion/
â”‚   â”‚       â”œâ”€â”€ page.tsx          # Lista de planificaciones
â”‚   â”‚       â””â”€â”€ nuevo/
â”‚   â”‚           â””â”€â”€ page.tsx      # Crear nueva planificaciÃ³n (3 pasos)
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                    # MÃ³dulo Administrador
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # Dashboard del admin
â”‚   â”‚   â”œâ”€â”€ lecciones/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # GestiÃ³n de lecciones
â”‚   â”‚   â”‚   â”œâ”€â”€ crear/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # Crear nueva lecciÃ³n
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ editar/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx  # Editar lecciÃ³n existente
â”‚   â”‚   â”œâ”€â”€ multimedia/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # Biblioteca multimedia
â”‚   â”‚   â””â”€â”€ usuarios/
â”‚   â”‚       â”œâ”€â”€ page.tsx          # GestiÃ³n de usuarios
â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚           â””â”€â”€ editar/
â”‚   â”‚               â””â”€â”€ page.tsx  # Editar usuario
â”‚   â”‚
â”‚   â””â”€â”€ mantenimiento/            # MÃ³dulo Mantenimiento
â”‚       â”œâ”€â”€ dashboard/
â”‚       â”‚   â””â”€â”€ page.tsx          # Dashboard de mantenimiento
â”‚       â”œâ”€â”€ reportes/
â”‚       â”‚   â”œâ”€â”€ page.tsx          # Lista de reportes de bugs
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â””â”€â”€ page.tsx      # Detalle de reporte
â”‚       â””â”€â”€ tareas/
â”‚           â”œâ”€â”€ page.tsx          # Lista de tareas programadas
â”‚           â””â”€â”€ nueva/
â”‚               â””â”€â”€ page.tsx      # Crear nueva tarea
â”‚
â”œâ”€â”€ components/                   # Componentes reutilizables
â”‚   â”œâ”€â”€ ui/                       # Componentes base de shadcn/ui
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ breadcrumb.tsx
â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”œâ”€â”€ radio-group.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                     # Componentes de autenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”œâ”€â”€ register-form.tsx
â”‚   â”‚   â”œâ”€â”€ level-assignment-flow.tsx
â”‚   â”‚   â””â”€â”€ password-recovery-form.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/                # Componentes del dashboard alumno
â”‚   â”‚   â”œâ”€â”€ dashboard-header.tsx  # Header con navegaciÃ³n por rol
â”‚   â”‚   â”œâ”€â”€ progress-overview.tsx
â”‚   â”‚   â”œâ”€â”€ streak-card.tsx
â”‚   â”‚   â”œâ”€â”€ quick-actions.tsx
â”‚   â”‚   â””â”€â”€ recent-lessons.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ lessons/                  # Componentes de lecciones
â”‚   â”‚   â”œâ”€â”€ lesson-filters.tsx
â”‚   â”‚   â”œâ”€â”€ lesson-list.tsx
â”‚   â”‚   â”œâ”€â”€ lesson-viewer.tsx
â”‚   â”‚   â”œâ”€â”€ completion-modal.tsx
â”‚   â”‚   â”œâ”€â”€ abandon-lesson-modal.tsx
â”‚   â”‚   â””â”€â”€ activities/           # Tipos de actividades
â”‚   â”‚       â”œâ”€â”€ multiple-choice-activity.tsx
â”‚   â”‚       â”œâ”€â”€ fill-blank-activity.tsx
â”‚   â”‚       â”œâ”€â”€ true-false-activity.tsx
â”‚   â”‚       â”œâ”€â”€ word-order-activity.tsx
â”‚   â”‚       â”œâ”€â”€ matching-activity.tsx
â”‚   â”‚       â”œâ”€â”€ listen-repeat-activity.tsx
â”‚   â”‚       â””â”€â”€ translation-activity.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ gamification/             # Componentes de gamificaciÃ³n
â”‚   â”‚   â”œâ”€â”€ achievements-list.tsx
â”‚   â”‚   â”œâ”€â”€ level-progress.tsx
â”‚   â”‚   â”œâ”€â”€ rewards-inventory.tsx
â”‚   â”‚   â”œâ”€â”€ leaderboard-table.tsx
â”‚   â”‚   â”œâ”€â”€ leaderboard-filters.tsx
â”‚   â”‚   â””â”€â”€ user-rank-card.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ teacher/                  # Componentes del profesor
â”‚   â”‚   â”œâ”€â”€ teacher-stats.tsx
â”‚   â”‚   â”œâ”€â”€ student-performance.tsx
â”‚   â”‚   â”œâ”€â”€ recent-feedback.tsx
â”‚   â”‚   â”œâ”€â”€ quick-teacher-actions.tsx
â”‚   â”‚   â”œâ”€â”€ create-planning-form.tsx
â”‚   â”‚   â””â”€â”€ response-modal.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                    # Componentes del admin
â”‚   â”‚   â”œâ”€â”€ admin-stats.tsx
â”‚   â”‚   â”œâ”€â”€ recent-lessons.tsx
â”‚   â”‚   â”œâ”€â”€ media-library-preview.tsx
â”‚   â”‚   â”œâ”€â”€ quick-admin-actions.tsx
â”‚   â”‚   â””â”€â”€ create-lesson-form.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ maintenance/              # Componentes de mantenimiento
â”‚   â”‚   â”œâ”€â”€ maintenance-stats.tsx
â”‚   â”‚   â”œâ”€â”€ recent-reports.tsx
â”‚   â”‚   â”œâ”€â”€ scheduled-tasks.tsx
â”‚   â”‚   â”œâ”€â”€ quick-maintenance-actions.tsx
â”‚   â”‚   â””â”€â”€ create-task-form.tsx
â”‚   â”‚
â”‚   â””â”€â”€ profile/                  # Componentes de perfil
â”‚       â””â”€â”€ profile-settings.tsx  # ConfiguraciÃ³n de perfil (role-aware)
â”‚
â”œâ”€â”€ scripts/                      # Scripts SQL para base de datos
â”‚   â”œâ”€â”€ 01-create-tables.sql     # CreaciÃ³n de tablas
â”‚   â””â”€â”€ 02-seed-initial-data.sql # Datos iniciales
â”‚
â”œâ”€â”€ docs/                         # DocumentaciÃ³n
â”‚   â”œâ”€â”€ PROGRESO_IMPLEMENTACION_FINAL.md
â”‚   â”œâ”€â”€ CONEXION_INTERFACES_FINAL.md
â”‚   â””â”€â”€ ARQUITECTURA_PROYECTO.md (este archivo)
â”‚
â”œâ”€â”€ lib/                          # Utilidades
â”‚   â””â”€â”€ utils.ts                  # FunciÃ³n cn() para clases
â”‚
â””â”€â”€ hooks/                        # Custom hooks
    â”œâ”€â”€ use-mobile.tsx
    â””â”€â”€ use-toast.ts
\`\`\`

---

## ğŸ§© MÃ³dulos del Sistema

### 1. **MÃ³dulo de AutenticaciÃ³n** ğŸ”
**PropÃ³sito**: Gestionar el acceso y registro de usuarios

**PÃ¡ginas**:
- `/` - Landing page con botones de login/registro
- `/login` - Inicio de sesiÃ³n
- `/registro` - Registro de nuevos usuarios
- `/verificar-email` - VerificaciÃ³n de correo electrÃ³nico
- `/recuperar-contrasena` - RecuperaciÃ³n de contraseÃ±a
- `/asignar-nivel` - AsignaciÃ³n de nivel inicial (evaluaciÃ³n o manual)
- `/correo-enviado` - ConfirmaciÃ³n de envÃ­o de correo

**Componentes Clave**:
- `components/auth/login-form.tsx` - Formulario de login con usuarios de prueba
- `components/auth/register-form.tsx` - Formulario de registro
- `components/auth/level-assignment-flow.tsx` - Flujo de asignaciÃ³n de nivel
- `components/auth/password-recovery-form.tsx` - RecuperaciÃ³n de contraseÃ±a

**Interacciones**:
- Almacena `userRole` y `userName` en `localStorage` tras login exitoso
- Redirige segÃºn rol:
  - `estudiante` â†’ `/dashboard`
  - `profesor` â†’ `/profesor/dashboard`
  - `admin` â†’ `/admin/dashboard`
  - `mantenimiento` â†’ `/mantenimiento/dashboard`

**APIs Necesarias**:
\`\`\`python
POST /api/auth/login
POST /api/auth/register
POST /api/auth/verify-email
POST /api/auth/forgot-password
POST /api/auth/reset-password
POST /api/auth/assign-level
\`\`\`

---

### 2. **MÃ³dulo Alumno** ğŸ“
**PropÃ³sito**: Experiencia de aprendizaje gamificada para estudiantes

**PÃ¡ginas**:
- `/dashboard` - Dashboard principal con progreso, racha, acciones rÃ¡pidas
- `/lecciones` - Lista de lecciones con filtros
- `/lecciones/[id]` - Visor de lecciÃ³n con actividades interactivas
- `/logros` - Logros desbloqueados y recompensas
- `/clasificacion` - Tabla de clasificaciÃ³n (leaderboard)
- `/progreso` - Progreso detallado por curso y lecciÃ³n
- `/perfil` - Perfil del usuario con configuraciÃ³n
- `/cambiar-curso` - Cambiar curso actual
- `/eliminar-cuenta` - Proceso de eliminaciÃ³n de cuenta (3 pasos)

**Componentes Clave**:
- `components/dashboard/dashboard-header.tsx` - Header con navegaciÃ³n role-aware
- `components/lessons/lesson-viewer.tsx` - Visor de lecciones con actividades
- `components/lessons/activities/*` - 7 tipos de actividades interactivas
- `components/gamification/*` - Sistema de gamificaciÃ³n

**Tipos de Actividades**:
1. **OpciÃ³n MÃºltiple** (`multiple-choice-activity.tsx`)
2. **Completar Espacios** (`fill-blank-activity.tsx`)
3. **Verdadero/Falso** (`true-false-activity.tsx`)
4. **Ordenar Palabras** (`word-order-activity.tsx`)
5. **Emparejar** (`matching-activity.tsx`)
6. **Escuchar y Repetir** (`listen-repeat-activity.tsx`)
7. **TraducciÃ³n** (`translation-activity.tsx`)

**Interacciones**:
- Lee `userRole` de `localStorage` para mostrar navegaciÃ³n correcta
- Actualiza progreso tras completar actividades
- Calcula XP y actualiza racha diaria
- Desbloquea logros segÃºn criterios

**APIs Necesarias**:
\`\`\`python
GET /api/student/dashboard
GET /api/student/lessons?course_id=&level=&status=
GET /api/student/lessons/:id
POST /api/student/lessons/:id/complete
GET /api/student/achievements
GET /api/student/leaderboard?period=&course_id=
GET /api/student/progress
PUT /api/student/profile
POST /api/student/change-course
DELETE /api/student/account
\`\`\`

---

### 3. **MÃ³dulo Profesor** ğŸ‘¨â€ğŸ«
**PropÃ³sito**: Herramientas para profesores para monitorear y guiar estudiantes

**PÃ¡ginas**:
- `/profesor/dashboard` - Dashboard con estadÃ­sticas y acciones rÃ¡pidas
- `/profesor/estadisticas` - EstadÃ­sticas generales de estudiantes
- `/profesor/estadisticas/[id]` - Detalle de alumno individual
- `/profesor/retroalimentacion` - GestiÃ³n de retroalimentaciÃ³n de estudiantes
- `/profesor/planificacion` - Lista de planificaciones
- `/profesor/planificacion/nuevo` - Crear nueva planificaciÃ³n (3 pasos)

**Componentes Clave**:
- `components/teacher/teacher-stats.tsx` - EstadÃ­sticas del profesor
- `components/teacher/student-performance.tsx` - Rendimiento de estudiantes
- `components/teacher/create-planning-form.tsx` - Formulario de planificaciÃ³n (3 pasos)
- `components/teacher/response-modal.tsx` - Modal para responder retroalimentaciÃ³n

**Interacciones**:
- Visualiza estadÃ­sticas agregadas de estudiantes
- Exporta reportes en CSV
- Responde a comentarios/preguntas de estudiantes
- Crea planificaciones personalizadas por Ã¡rea de mejora

**APIs Necesarias**:
\`\`\`python
GET /api/teacher/dashboard
GET /api/teacher/statistics
GET /api/teacher/students/:id
GET /api/teacher/feedback
POST /api/teacher/feedback/:id/respond
GET /api/teacher/planning
POST /api/teacher/planning
GET /api/teacher/export/statistics
\`\`\`

---

### 4. **MÃ³dulo Administrador** âš™ï¸
**PropÃ³sito**: GestiÃ³n de contenido, usuarios y configuraciÃ³n del sistema

**PÃ¡ginas**:
- `/admin/dashboard` - Dashboard con estadÃ­sticas del sistema
- `/admin/lecciones` - GestiÃ³n de lecciones
- `/admin/lecciones/crear` - Crear nueva lecciÃ³n
- `/admin/lecciones/[id]/editar` - Editar lecciÃ³n existente
- `/admin/multimedia` - Biblioteca multimedia
- `/admin/usuarios` - GestiÃ³n de usuarios
- `/admin/usuarios/[id]/editar` - Editar usuario

**Componentes Clave**:
- `components/admin/admin-stats.tsx` - EstadÃ­sticas del sistema
- `components/admin/create-lesson-form.tsx` - Formulario de creaciÃ³n de lecciones
- `components/admin/media-library-preview.tsx` - Vista previa de multimedia

**Interacciones**:
- CRUD completo de lecciones y actividades
- GestiÃ³n de usuarios (crear, editar, eliminar, cambiar roles)
- Subida y gestiÃ³n de archivos multimedia
- ConfiguraciÃ³n de cursos y niveles

**APIs Necesarias**:
\`\`\`python
GET /api/admin/dashboard
GET /api/admin/lessons
POST /api/admin/lessons
PUT /api/admin/lessons/:id
DELETE /api/admin/lessons/:id
GET /api/admin/media
POST /api/admin/media/upload
DELETE /api/admin/media/:id
GET /api/admin/users
POST /api/admin/users
PUT /api/admin/users/:id
DELETE /api/admin/users/:id
\`\`\`

---

### 5. **MÃ³dulo Mantenimiento** ğŸ”§
**PropÃ³sito**: GestiÃ³n de reportes de bugs y tareas programadas

**PÃ¡ginas**:
- `/mantenimiento/dashboard` - Dashboard de mantenimiento
- `/mantenimiento/reportes` - Lista de reportes de bugs
- `/mantenimiento/reportes/[id]` - Detalle de reporte individual
- `/mantenimiento/tareas` - Lista de tareas programadas
- `/mantenimiento/tareas/nueva` - Crear nueva tarea

**Componentes Clave**:
- `components/maintenance/maintenance-stats.tsx` - EstadÃ­sticas de mantenimiento
- `components/maintenance/recent-reports.tsx` - Reportes recientes
- `components/maintenance/create-task-form.tsx` - Formulario de tareas

**Interacciones**:
- Visualiza y gestiona reportes de bugs
- Asigna prioridades y estados a reportes
- Programa tareas de mantenimiento
- Monitorea salud del sistema

**APIs Necesarias**:
\`\`\`python
GET /api/maintenance/dashboard
GET /api/maintenance/reports
GET /api/maintenance/reports/:id
PUT /api/maintenance/reports/:id
GET /api/maintenance/tasks
POST /api/maintenance/tasks
PUT /api/maintenance/tasks/:id
DELETE /api/maintenance/tasks/:id
\`\`\`

---

## ğŸ”„ Flujo de Datos

### Flujo de AutenticaciÃ³n
\`\`\`
1. Usuario ingresa credenciales en /login
2. LoginForm envÃ­a datos (actualmente mock)
3. Backend valida credenciales
4. Backend retorna: { user_id, name, email, role, token }
5. Frontend guarda en localStorage:
   - userRole: "estudiante" | "profesor" | "admin" | "mantenimiento"
   - userName: string
   - authToken: string (para futuras peticiones)
6. Redirige segÃºn rol
\`\`\`

### Flujo de LecciÃ³n
\`\`\`
1. Alumno navega a /lecciones
2. LessonList obtiene lecciones del backend
3. Alumno selecciona lecciÃ³n â†’ /lecciones/[id]
4. LessonViewer carga lecciÃ³n y actividades
5. Alumno completa actividades una por una
6. Al finalizar, se calcula puntuaciÃ³n
7. Se envÃ­a progreso al backend
8. Backend actualiza:
   - user_progress (lecciÃ³n completada)
   - user_stats (XP, racha)
   - achievements (si se desbloquean)
9. Frontend muestra CompletionModal con resultados
\`\`\`

### Flujo de GamificaciÃ³n
\`\`\`
1. Backend calcula XP tras cada lecciÃ³n
2. Frontend consulta /api/student/achievements
3. Backend verifica criterios de logros:
   - Lecciones completadas
   - DÃ­as consecutivos (racha)
   - PuntuaciÃ³n perfecta
   - Tiempo rÃ©cord
4. Si se desbloquea logro, backend retorna notificaciÃ³n
5. Frontend muestra animaciÃ³n de logro desbloqueado
6. Leaderboard se actualiza automÃ¡ticamente
\`\`\`

---

## ğŸ¨ Componentes Principales

### DashboardHeader (Role-Aware)
**UbicaciÃ³n**: `components/dashboard/dashboard-header.tsx`

**PropÃ³sito**: Header de navegaciÃ³n que cambia segÃºn el rol del usuario

**LÃ³gica**:
\`\`\`typescript
const userRole = localStorage.getItem('userRole')

if (userRole === 'estudiante') {
  // Muestra: Dashboard, Lecciones, Logros, ClasificaciÃ³n
}
if (userRole === 'profesor') {
  // Muestra: Dashboard, EstadÃ­sticas, RetroalimentaciÃ³n, PlanificaciÃ³n
}
if (userRole === 'admin') {
  // Muestra: Dashboard, Lecciones, Biblioteca, Usuarios
}
if (userRole === 'mantenimiento') {
  // Muestra: Dashboard, Reportes, Tareas
}
\`\`\`

**InteracciÃ³n con Backend**:
- Necesita endpoint para obtener notificaciones: `GET /api/notifications`
- Necesita endpoint para logout: `POST /api/auth/logout`

---

### LessonViewer
**UbicaciÃ³n**: `components/lessons/lesson-viewer.tsx`

**PropÃ³sito**: Renderiza lecciones con actividades interactivas

**Estructura de Datos Esperada**:
\`\`\`typescript
interface Lesson {
  id: number
  title: string
  description: string
  level: string
  xp_reward: number
  activities: Activity[]
}

interface Activity {
  id: number
  type: 'multiple_choice' | 'fill_blank' | 'true_false' | 
        'word_order' | 'matching' | 'listen_repeat' | 'translation'
  question: string
  options?: string[]  // Para multiple_choice
  correct_answer: string | string[]
  audio_url?: string  // Para listen_repeat
  image_url?: string
  hint?: string
}
\`\`\`

**Flujo**:
1. Recibe `lessonId` de la URL
2. Llama `GET /api/student/lessons/:id`
3. Renderiza actividades segÃºn `activity.type`
4. Valida respuestas del usuario
5. Calcula puntuaciÃ³n final
6. EnvÃ­a resultados: `POST /api/student/lessons/:id/complete`

---

### ProfileSettings (Role-Aware)
**UbicaciÃ³n**: `components/profile/profile-settings.tsx`

**PropÃ³sito**: ConfiguraciÃ³n de perfil adaptada al rol

**LÃ³gica**:
\`\`\`typescript
const userRole = localStorage.getItem('userRole')

// Solo para estudiantes:
if (userRole === 'estudiante') {
  // Muestra: Nivel Actual, Curso Actual, Zona de Peligro
}

// Para profesor, admin, mantenimiento:
// NO muestra: Nivel Actual, Curso Actual, Zona de Peligro
// Solo muestra: InformaciÃ³n Personal, Preferencias
\`\`\`

---

## ğŸ—ºï¸ Rutas y NavegaciÃ³n

### Rutas PÃºblicas (No requieren autenticaciÃ³n)
- `/` - Landing page
- `/login` - Inicio de sesiÃ³n
- `/registro` - Registro
- `/verificar-email` - VerificaciÃ³n de email
- `/recuperar-contrasena` - RecuperaciÃ³n de contraseÃ±a
- `/correo-enviado` - ConfirmaciÃ³n

### Rutas Protegidas por Rol

#### Estudiante (`userRole === 'estudiante'`)
- `/dashboard`
- `/lecciones`
- `/lecciones/[id]`
- `/logros`
- `/clasificacion`
- `/progreso`
- `/perfil`
- `/cambiar-curso`
- `/eliminar-cuenta`

#### Profesor (`userRole === 'profesor'`)
- `/profesor/dashboard`
- `/profesor/estadisticas`
- `/profesor/estadisticas/[id]`
- `/profesor/retroalimentacion`
- `/profesor/planificacion`
- `/profesor/planificacion/nuevo`
- `/perfil`

#### Admin (`userRole === 'admin'`)
- `/admin/dashboard`
- `/admin/lecciones`
- `/admin/lecciones/crear`
- `/admin/lecciones/[id]/editar`
- `/admin/multimedia`
- `/admin/usuarios`
- `/admin/usuarios/[id]/editar`
- `/perfil`

#### Mantenimiento (`userRole === 'mantenimiento'`)
- `/mantenimiento/dashboard`
- `/mantenimiento/reportes`
- `/mantenimiento/reportes/[id]`
- `/mantenimiento/tareas`
- `/mantenimiento/tareas/nueva`
- `/perfil`

---

## ğŸ—„ï¸ Esquema de Base de Datos

**UbicaciÃ³n**: `scripts/01-create-tables.sql`

### Tablas Principales

#### users
\`\`\`sql
id, email, password_hash, name, role, created_at, last_login, 
email_verified, is_active
\`\`\`

#### courses
\`\`\`sql
id, name, description, language, level, created_at
\`\`\`

#### lessons
\`\`\`sql
id, course_id, title, description, level, order_index, xp_reward, 
estimated_time, created_at
\`\`\`

#### activities
\`\`\`sql
id, lesson_id, type, question, options, correct_answer, hint, 
audio_url, image_url, order_index
\`\`\`

#### user_progress
\`\`\`sql
id, user_id, lesson_id, status, score, attempts, completed_at, 
time_spent
\`\`\`

#### user_stats
\`\`\`sql
id, user_id, course_id, total_xp, current_level, lessons_completed, 
current_streak, longest_streak, last_activity_date
\`\`\`

#### achievements
\`\`\`sql
id, name, description, icon, criteria_type, criteria_value, 
xp_reward, badge_color
\`\`\`

#### user_achievements
\`\`\`sql
id, user_id, achievement_id, unlocked_at, progress
\`\`\`

#### leaderboard
\`\`\`sql
id, user_id, course_id, total_xp, rank, period, updated_at
\`\`\`

#### feedback
\`\`\`sql
id, user_id, teacher_id, lesson_id, comment, rating, status, 
response, created_at, responded_at
\`\`\`

#### planning
\`\`\`sql
id, teacher_id, student_id, title, description, focus_area, 
lessons, start_date, end_date, status, created_at
\`\`\`

#### bug_reports
\`\`\`sql
id, user_id, title, description, severity, status, assigned_to, 
created_at, resolved_at
\`\`\`

#### scheduled_tasks
\`\`\`sql
id, name, description, frequency, last_run, next_run, status, 
created_by
\`\`\`

#### multimedia
\`\`\`sql
id, filename, file_type, file_size, url, uploaded_by, created_at
\`\`\`

**Ver esquema completo en**: `scripts/01-create-tables.sql`

---

## ğŸ”Œ APIs Necesarias para Backend

### Estructura de Respuesta EstÃ¡ndar
\`\`\`python
# Ã‰xito
{
  "success": True,
  "data": {...},
  "message": "OperaciÃ³n exitosa"
}

# Error
{
  "success": False,
  "error": "Mensaje de error",
  "code": "ERROR_CODE"
}
\`\`\`

### Endpoints por MÃ³dulo

#### AutenticaciÃ³n
\`\`\`python
POST   /api/auth/login
POST   /api/auth/register
POST   /api/auth/verify-email
POST   /api/auth/forgot-password
POST   /api/auth/reset-password
POST   /api/auth/assign-level
POST   /api/auth/logout
GET    /api/auth/me  # Obtener usuario actual
\`\`\`

#### Estudiante
\`\`\`python
GET    /api/student/dashboard
GET    /api/student/lessons
GET    /api/student/lessons/:id
POST   /api/student/lessons/:id/complete
GET    /api/student/achievements
GET    /api/student/leaderboard
GET    /api/student/progress
PUT    /api/student/profile
POST   /api/student/change-course
DELETE /api/student/account
POST   /api/student/feedback  # Enviar retroalimentaciÃ³n
\`\`\`

#### Profesor
\`\`\`python
GET    /api/teacher/dashboard
GET    /api/teacher/statistics
GET    /api/teacher/students/:id
GET    /api/teacher/feedback
POST   /api/teacher/feedback/:id/respond
GET    /api/teacher/planning
POST   /api/teacher/planning
PUT    /api/teacher/planning/:id
DELETE /api/teacher/planning/:id
GET    /api/teacher/export/statistics  # Exportar CSV
\`\`\`

#### Admin
\`\`\`python
GET    /api/admin/dashboard
GET    /api/admin/lessons
POST   /api/admin/lessons
PUT    /api/admin/lessons/:id
DELETE /api/admin/lessons/:id
GET    /api/admin/media
POST   /api/admin/media/upload
DELETE /api/admin/media/:id
GET    /api/admin/users
POST   /api/admin/users
PUT    /api/admin/users/:id
DELETE /api/admin/users/:id
GET    /api/admin/courses
POST   /api/admin/courses
\`\`\`

#### Mantenimiento
\`\`\`python
GET    /api/maintenance/dashboard
GET    /api/maintenance/reports
GET    /api/maintenance/reports/:id
PUT    /api/maintenance/reports/:id
GET    /api/maintenance/tasks
POST   /api/maintenance/tasks
PUT    /api/maintenance/tasks/:id
DELETE /api/maintenance/tasks/:id
\`\`\`

#### Global
\`\`\`python
GET    /api/notifications  # Notificaciones del usuario
PUT    /api/notifications/:id/read
\`\`\`

---

## ğŸ” AutenticaciÃ³n y AutorizaciÃ³n

### Flujo de AutenticaciÃ³n con Flask

#### 1. Login
\`\`\`python
# Frontend envÃ­a:
POST /api/auth/login
{
  "email": "juan@example.com",
  "password": "password123"
}

# Backend responde:
{
  "success": True,
  "data": {
    "user": {
      "id": 1,
      "name": "Juan PÃ©rez",
      "email": "juan@example.com",
      "role": "estudiante"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}

# Frontend guarda en localStorage:
localStorage.setItem('authToken', data.token)
localStorage.setItem('userRole', data.user.role)
localStorage.setItem('userName', data.user.name)
\`\`\`

#### 2. Peticiones Autenticadas
\`\`\`typescript
// Frontend incluye token en headers:
fetch('/api/student/dashboard', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
    'Content-Type': 'application/json'
  }
})
\`\`\`

#### 3. Middleware de AutorizaciÃ³n (Flask)
\`\`\`python
from functools import wraps
from flask import request, jsonify
import jwt

def token_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return jsonify({'error': 'Token missing'}), 401
        
        try:
            token = token.split(' ')[1]  # Remove 'Bearer '
            data = jwt.decode(token, app.config['SECRET_KEY'])
            current_user = User.query.get(data['user_id'])
        except:
            return jsonify({'error': 'Token invalid'}), 401
        
        return f(current_user, *args, **kwargs)
    return decorated

def role_required(roles):
    def decorator(f):
        @wraps(f)
        def decorated(current_user, *args, **kwargs):
            if current_user.role not in roles:
                return jsonify({'error': 'Unauthorized'}), 403
            return f(current_user, *args, **kwargs)
        return decorated
    return decorator

# Uso:
@app.route('/api/teacher/dashboard')
@token_required
@role_required(['profesor'])
def teacher_dashboard(current_user):
    # Solo profesores pueden acceder
    pass
\`\`\`

---

## ğŸ”— IntegraciÃ³n Frontend-Backend

### ConfiguraciÃ³n de Variables de Entorno

**Frontend** (`.env.local`):
\`\`\`bash
NEXT_PUBLIC_API_URL=http://localhost:5000/api
SUPABASE_NEXT_PUBLIC_SUPABASE_URL=your_supaSUPABASE_NEXT_PUBLIC_SUPABASE_ANON_KEY_ANON_KEY=your_supabase_key
\`\`\`

**Backend** (`.env`):
\`\`\`bash
FLASK_APP=app.py
FLASK_ENV=development
SECRET_KEY=your_secret_key
DATABASE_URL=postgresql://user:password@localhost/speaklexi
JWT_SECRET_KEY=your_jwt_secret
CORS_ORIGINS=http://localhost:3000
\`\`\`

### Cliente API (Frontend)

**Crear**: `lib/api-client.ts`
\`\`\`typescript
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'

export class ApiClient {
  private getHeaders(): HeadersInit {
    const token = localStorage.getItem('authToken')
    return {
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` })
    }
  }

  async get(endpoint: string) {
    const response = await fetch(`${API_URL}${endpoint}`, {
      headers: this.getHeaders()
    })
    return this.handleResponse(response)
  }

  async post(endpoint: string, data: any) {
    const response = await fetch(`${API_URL}${endpoint}`, {
      method: 'POST',
      headers: this.getHeaders(),
      body: JSON.stringify(data)
    })
    return this.handleResponse(response)
  }

  async put(endpoint: string, data: any) {
    const response = await fetch(`${API_URL}${endpoint}`, {
      method: 'PUT',
      headers: this.getHeaders(),
      body: JSON.stringify(data)
    })
    return this.handleResponse(response)
  }

  async delete(endpoint: string) {
    const response = await fetch(`${API_URL}${endpoint}`, {
      method: 'DELETE',
      headers: this.getHeaders()
    })
    return this.handleResponse(response)
  }

  private async handleResponse(response: Response) {
    const data = await response.json()
    
    if (!response.ok) {
      throw new Error(data.error || 'Request failed')
    }
    
    return data
  }
}

export const api = new ApiClient()
\`\`\`

**Uso en Componentes**:
\`\`\`typescript
import { api } from '@/lib/api-client'

// En lugar de datos mock:
const lessons = await api.get('/student/lessons?course_id=1')

// Completar lecciÃ³n:
await api.post(`/student/lessons/${lessonId}/complete`, {
  score: 95,
  time_spent: 180,
  answers: [...]
})
\`\`\`

### Estructura del Backend Flask

\`\`\`
backend/
â”œâ”€â”€ app.py                    # AplicaciÃ³n principal
â”œâ”€â”€ config.py                 # ConfiguraciÃ³n
â”œâ”€â”€ requirements.txt          # Dependencias
â”œâ”€â”€ .env                      # Variables de entorno
â”‚
â”œâ”€â”€ models/                   # Modelos SQLAlchemy
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ course.py
â”‚   â”œâ”€â”€ lesson.py
â”‚   â”œâ”€â”€ activity.py
â”‚   â”œâ”€â”€ progress.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ routes/                   # Blueprints de rutas
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py
â”‚   â”œâ”€â”€ student.py
â”‚   â”œâ”€â”€ teacher.py
â”‚   â”œâ”€â”€ admin.py
â”‚   â””â”€â”€ maintenance.py
â”‚
â”œâ”€â”€ services/                 # LÃ³gica de negocio
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”œâ”€â”€ lesson_service.py
â”‚   â”œâ”€â”€ gamification_service.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ utils/                    # Utilidades
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ decorators.py         # @token_required, @role_required
â”‚   â”œâ”€â”€ validators.py
â”‚   â””â”€â”€ helpers.py
â”‚
â””â”€â”€ migrations/               # Migraciones de base de datos
    â””â”€â”€ ...
\`\`\`

### Ejemplo de Endpoint Flask

\`\`\`python
# routes/student.py
from flask import Blueprint, request, jsonify
from models.lesson import Lesson
from models.user_progress import UserProgress
from utils.decorators import token_required, role_required
from services.gamification_service import GamificationService

student_bp = Blueprint('student', __name__)

@student_bp.route('/lessons', methods=['GET'])
@token_required
@role_required(['estudiante'])
def get_lessons(current_user):
    course_id = request.args.get('course_id')
    level = request.args.get('level')
    status = request.args.get('status')
    
    query = Lesson.query
    
    if course_id:
        query = query.filter_by(course_id=course_id)
    if level:
        query = query.filter_by(level=level)
    
    lessons = query.all()
    
    # Agregar progreso del usuario
    lessons_data = []
    for lesson in lessons:
        progress = UserProgress.query.filter_by(
            user_id=current_user.id,
            lesson_id=lesson.id
        ).first()
        
        lessons_data.append({
            'id': lesson.id,
            'title': lesson.title,
            'description': lesson.description,
            'level': lesson.level,
            'xp_reward': lesson.xp_reward,
            'status': progress.status if progress else 'not_started',
            'score': progress.score if progress else None
        })
    
    return jsonify({
        'success': True,
        'data': lessons_data
    })

@student_bp.route('/lessons/<int:lesson_id>/complete', methods=['POST'])
@token_required
@role_required(['estudiante'])
def complete_lesson(current_user, lesson_id):
    data = request.json
    score = data.get('score')
    time_spent = data.get('time_spent')
    
    # Guardar progreso
    progress = UserProgress(
        user_id=current_user.id,
        lesson_id=lesson_id,
        status='completed',
        score=score,
        time_spent=time_spent
    )
    db.session.add(progress)
    
    # Actualizar estadÃ­sticas y gamificaciÃ³n
    gamification = GamificationService()
    result = gamification.process_lesson_completion(
        current_user, 
        lesson_id, 
        score
    )
    
    db.session.commit()
    
    return jsonify({
        'success': True,
        'data': {
            'xp_earned': result['xp_earned'],
            'new_achievements': result['new_achievements'],
            'level_up': result['level_up']
        }
    })
\`\`\`

---

## ğŸ“Š Consideraciones de Rendimiento

### Frontend
- **Code Splitting**: Next.js automÃ¡ticamente divide el cÃ³digo por rutas
- **Lazy Loading**: Componentes pesados se cargan bajo demanda
- **OptimizaciÃ³n de ImÃ¡genes**: Usar `next/image` para imÃ¡genes optimizadas
- **Caching**: SWR o React Query para cachear peticiones

### Backend
- **PaginaciÃ³n**: Implementar en listas largas (lecciones, usuarios, reportes)
- **Ãndices de Base de Datos**: En columnas frecuentemente consultadas
- **Caching**: Redis para datos frecuentemente accedidos (leaderboard, estadÃ­sticas)
- **Rate Limiting**: Limitar peticiones por usuario/IP

---

## ğŸš€ PrÃ³ximos Pasos para ImplementaciÃ³n Backend

### Fase 1: Setup Inicial
1. Configurar Flask + SQLAlchemy + PostgreSQL
2. Implementar autenticaciÃ³n JWT
3. Crear modelos de base de datos
4. Configurar CORS para Next.js

### Fase 2: MÃ³dulo AutenticaciÃ³n
1. Endpoints de login/registro
2. VerificaciÃ³n de email
3. RecuperaciÃ³n de contraseÃ±a
4. Middleware de autorizaciÃ³n

### Fase 3: MÃ³dulo Alumno
1. Endpoints de lecciones
2. Sistema de progreso
3. GamificaciÃ³n (XP, logros, leaderboard)
4. Perfil de usuario

### Fase 4: MÃ³dulos Profesor, Admin, Mantenimiento
1. EstadÃ­sticas y reportes
2. GestiÃ³n de contenido
3. Sistema de retroalimentaciÃ³n
4. Planificaciones

### Fase 5: OptimizaciÃ³n
1. Caching con Redis
2. Subida de archivos multimedia
3. Notificaciones en tiempo real (WebSockets)
4. Tests unitarios e integraciÃ³n

---

## ğŸ“ Notas Finales

### Estado Actual del Frontend
- âœ… Todas las interfaces implementadas
- âœ… NavegaciÃ³n completa entre mÃ³dulos
- âœ… Componentes reutilizables y modulares
- âœ… Sistema de roles funcional (localStorage)
- âš ï¸ Datos mock (listos para reemplazar con API calls)

### PreparaciÃ³n para Backend
- âœ… Esquema de base de datos definido
- âœ… Estructura de APIs documentada
- âœ… Flujos de autenticaciÃ³n diseÃ±ados
- âœ… Cliente API preparado (`lib/api-client.ts`)
- âš ï¸ Requiere implementaciÃ³n de Flask

### Contacto y Mantenimiento
Para preguntas sobre la arquitectura o implementaciÃ³n del backend, referirse a:
- `docs/PROGRESO_IMPLEMENTACION_FINAL.md` - Estado de implementaciÃ³n
- `docs/CONEXION_INTERFACES_FINAL.md` - Conexiones entre interfaces
- `scripts/01-create-tables.sql` - Esquema de base de datos completo

---

**Ãšltima actualizaciÃ³n**: 2025
**VersiÃ³n del documento**: 1.0
**Autor**: v0 AI Assistant
